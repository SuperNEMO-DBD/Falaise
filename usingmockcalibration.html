<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Falaise: Using Mock Calibration for Reconstruction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Falaise
   &#160;<span id="projectnumber">3.1.0</span>
   </div>
   <div id="projectbrief">SuperNEMO Software Toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Using Mock Calibration for Reconstruction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#mockcalo_intro">Introduction </a></li>
<li class="level1"><a href="#mockcalo_using">Using the Mock Calibration Models </a></li>
<li class="level1"><a href="#mockcalo_future">Future Development </a><ul><li class="level2"><a href="#mockcalo_digidevel">Specific Topics for Development of Digitization </a></li>
<li class="level2"><a href="#mockcalo_calodevel">Specific Topics for Development of Calibration </a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="mockcalo_intro"></a>
Introduction </h1>
<p>Falaise currently only provides a mocking model for digitization and calibration of data after the Geant4 part of the simulation has completed. This is due to the developing nature of the physical electronic system at the time of writing, and thus the digitization/calibration is currently provided as an optional "preprocessing" step within <code>flreconstruct</code>.</p>
<p>This allows a basic model to be used, and does not prevent further validation and implementation of new digitization and calibration models.</p>
<h1><a class="anchor" id="mockcalo_using"></a>
Using the Mock Calibration Models </h1>
<p>To use the mocking model as the first step of the pipeline, two modules need to be run; <code><a class="el" href="classsnemo_1_1processing_1_1mock__tracker__s2c__module.html" title="Simple modelling of the time and space measurement with the SuperNEMO drift cells in Geiger mode...">snemo::processing::mock_tracker_s2c_module</a></code> and <code><a class="el" href="classsnemo_1_1processing_1_1mock__calorimeter__s2c__module.html" title="A mock calibration for SuperNEMO calorimeter hits. ">snemo::processing::mock_calorimeter_s2c_module</a></code>. The following example script shows how these may be run</p>
<div class="fragment"><div class="line"># - Configuration</div><div class="line">#@description Simple pipeline using a chain</div><div class="line">#@key_label   &quot;name&quot;</div><div class="line">#@meta_label  &quot;type&quot;</div><div class="line"></div><div class="line"># - Module load section</div><div class="line">#[name=&quot;flreconstruct.plugins&quot; type=&quot;&quot;]</div><div class="line">#plugins : string[1] = &quot;MyModule&quot;</div><div class="line"></div><div class="line"># Must define &quot;pipeline&quot; as this is the module flreconstruct will use</div><div class="line">[name=&quot;pipeline&quot; type=&quot;dpp::chain_module&quot;]</div><div class="line">modules : string[2] = &quot;MockCalibration&quot; &quot;Dump&quot;</div><div class="line"></div><div class="line">[name=&quot;MockCalibration&quot; type=&quot;dpp::chain_module&quot;]</div><div class="line">modules : string[2] = &quot;CalibrateTracker&quot; &quot;CalibrateCalorimeters&quot;</div><div class="line"></div><div class="line">[name=&quot;CalibrateTracker&quot; type=&quot;snemo::processing::mock_tracker_s2c_module&quot;]</div><div class="line">Geo_label : string = &quot;geometry&quot;</div><div class="line"></div><div class="line">[name=&quot;CalibrateCalorimeters&quot; type=&quot;snemo::processing::mock_calorimeter_s2c_module&quot;]</div><div class="line">Geo_label : string = &quot;geometry&quot;</div><div class="line">hit_categories  : string[3]  = &quot;calo&quot; &quot;xcalo&quot; &quot;gveto&quot;</div><div class="line"></div><div class="line">[name=&quot;Dump&quot; type=&quot;dpp::dump_module&quot;]</div><div class="line"></div><div class="line"></div></div><!-- fragment --><p>This simply chains together the two modules, with a simple dump module as the last stage to demonstrate that the "CD" (<b>C</b> alibrated <b>D</b> ata) data bank is added. It is this bank that should be used for any reconstruction or analysis task, and it should be read as an instance of <code><a class="el" href="classsnemo_1_1datamodel_1_1calibrated__data.html" title="The data structure that hosts information about calibrated hits. ">snemo::datamodel::calibrated_data</a></code>. The documentation of that object should be consulted for information on accessing Geiger and Calorimeter data.</p>
<p>You can replace the dump module in the above example with a chain of your own reconstruction and analysis modules.</p>
<h1><a class="anchor" id="mockcalo_future"></a>
Future Development </h1>
<p>The mocking modules implement both digitization and calibration steps. In future, the digitization step will be refactored into <code>flsimulate</code> as the intent is for the simulation to output data in an identical format to the physical experiment(s). The calibration step will be refactored into a core module of <code>flreconstruct</code>.</p>
<p>Neither of these refactorings affect you if you wish to develop and propose new digitization or calibration models. You should however take care to not overwrite the "official" data banks for simulated and calibrated data ("SD" and "CD" respectively). This is allow easy comparison and validation of any new model with the "official" one, as both "official" and "new" data banks will be available to downstream modules.</p>
<h2><a class="anchor" id="mockcalo_digidevel"></a>
Specific Topics for Development of Digitization </h2>
<p>You should implement custom digitization as <a class="el" href="writingflreconstructmodules.html">a processing module in flreconstruct</a>, using the <a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classmctools_1_1simulated__data.html">mctools::simulated_data</a>SD" data bank" output from <code>flsimulate</code> as the input. You should create <a class="el" href="writingflreconstructmodules.html">any needed custom types</a> to represent the digitized data and write these as a new bank in the <code><a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a></code> instance representing the event.</p>
<p>TODO : Define bank name for digital data.</p>
<h2><a class="anchor" id="mockcalo_calodevel"></a>
Specific Topics for Development of Calibration </h2>
<p>You should implement custom calibration as <a class="el" href="writingflreconstructmodules.html">a processing module in flreconstruct</a>. Your calibration model <b>must</b> output data in the form of an instance of <code><a class="el" href="classsnemo_1_1datamodel_1_1calibrated__data.html" title="The data structure that hosts information about calibrated hits. ">snemo::datamodel::calibrated_data</a></code>. You would write this into the <code><a class="elRef" doxygen="https://supernemo-dbd.github.io/Bayeux/bayeux.doxy.tag:https://supernemo-dbd.github.io/Bayeux/" href="https://supernemo-dbd.github.io/Bayeux/classdatatools_1_1things.html">datatools::things</a></code> event instance as a new data bank named, say, "CD_NewModel" to avoid clashes with the official "CD" bank. Downstream modules can access both banks for comparison and validation. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
