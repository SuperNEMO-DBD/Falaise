// -*- mode: graphviz-dot; indent-tabs-mode: nil; -*-

digraph falaise_geometry_config_principles {
  rankdir="BT";
  label="Falaise geometry configuration"
  labelloc="t";
  labeljust="l";
  fontsize="20";
  fontname="bold";
  {
    fontsize="16";
    fontname="normal";
    User[shape="egg"; label="User\n[interactive]"; ];
    Script[shape="diamond"; label="Script\n[batch]"; ];
    Script -> User[label="&laquo;created by&raquo;";];
         
    subgraph cluster_Geometry {
      label="Geometry configuration\nversion: \"5.0/2.0\"";
      labelloc="b";
      labeljust="l";
                 
      subgraph cluster_GeometryVariant {
        label="Geometry variants layer";

        GeometryVariantRegistry
        [
          shape="folder";
          label="Variant registry\nversion: \"2.0\"";
        ];
                         
        GeometryVariantRepository
        [
          shape="folder";
          label="Variant repository\nversion: \"2.0\"";
        ];

        subgraph {
          rank="same";
              
          GeometryVariantConfigurator
          [
            shape="component";
            label="Variant configurator";
          ];
        
          GeometryVariantConfiguratorNote
          [
            shape="note";
            label="flsimulate-configure\n[application]";
          ];
                                 
          GeometryVariantConfiguratorNote -> GeometryVariantConfigurator
          [
            //label="&laquo;implement&raquo;";
            dir="none";
            style="dashed";
          ];
        }

        GeometryVariantProfile
        [
          shape="folder";
          label="Variant profile";
        ];

        GeometryVariantRepository   -> GeometryVariantRegistry [label="&laquo;depend on&raquo;"];
        GeometryVariantConfigurator -> GeometryVariantRepository [label="&laquo;use&raquo;"];
        GeometryVariantProfile      -> GeometryVariantConfigurator [label="&laquo;generated by&raquo;" ];

      }                   

      GeometryConfigurationStatic
      [
        shape="folder";
        label="Configuration\nversion: \"5.0\"\n[static]";
      ];
                     
      GeometryConfigurationDynamic
      [
        shape="box";
        label="Configuration\n[dynamic]";
      ];

      GeometryVariantPreprocessor
      [
        shape="component";
        label="Variant preprocessor";
      ];
                       
      GeometryVariantPreprocessor  -> GeometryVariantProfile [label="&laquo;use&raquo;"];
      GeometryVariantPreprocessor  -> GeometryConfigurationStatic [label="&laquo;use&raquo;"];
      GeometryConfigurationDynamic -> GeometryVariantPreprocessor [label="&laquo;generated from&raquo;"];
                        
      GeometryManager
      [
        shape="component";
        label="Manager"; //\n[application]";
      ];

      GeometrySetup
      [
        shape="box";
        label="Setup";
      ];
                         
      GeometryManager -> GeometryConfigurationDynamic [label="&laquo;use&raquo;"];
      GeometrySetup   -> GeometryManager [label="&laquo;generated by&raquo;"];
      
      GeometryService
      [
        shape="component";
        label="Service";
      ];

      GeometryService -> GeometryManager [label="&laquo;use&raquo;"];
      GeometryService -> GeometrySetup [label="&laquo;publish&raquo;"];
    }
  }
  GeometryVariantConfigurator -> User [label="&laquo;used by&raquo;"];
  GeometryVariantConfigurator -> Script [label="&laquo;invoked by&raquo;"];
  GeometryConfigurationStatic -> User [label="&laquo;selected by&raquo;"];

}
